<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>client.py</title>
  <link rel="stylesheet" href="../../../pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>client.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Copyright (C) 2010 Google Inc.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<pre><code> http://www.apache.org/licenses/LICENSE-2.0
</code></pre>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
Service details and instances for the Docs service using GData 3.0.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Some use cases:
Upload a document:
  docs upload --folder "Some folder" path_to_doc</p>
<p>Edit a document in your word editor:
  docs edit --title "Grocery List" --editor vim (editor also set in prefs)</p>
<p>Download docs:
  docs get --folder "Some folder"</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">with_statement</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;tom.h.miller@gmail.com (Tom Miller)&#39;</span>
<span class="kn">import</span> <span class="nn">gdata.docs.client</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">googlecl</span>
<span class="kn">import</span> <span class="nn">googlecl.client</span>
<span class="kn">from</span> <span class="nn">googlecl.docs</span> <span class="kn">import</span> <span class="n">SECTION_HEADER</span>
<span class="kn">import</span> <span class="nn">googlecl.docs.base</span>
<span class="kn">import</span> <span class="nn">atom.data</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">LOGGER_NAME</span> <span class="o">+</span> <span class="s">&#39;.client&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Extends gdata.docs.client.DocsClient for the command line.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">DocsClientCL</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">DocsClient</span><span class="p">,</span>
                   <span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">DocsBaseCL</span><span class="p">,</span>
                   <span class="n">googlecl</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">BaseClientCL</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>This class adds some features focused on using Google Docs via an installed
app with a command line interface.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">DOCLIST_FEED_URI</span> <span class="o">=</span> <span class="s">&#39;/feeds/default/private/full&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>File extension/mimetype pairs of common format.
These seem to have disappeared in python-gdata 2.0.15 and 2.0.16, so here 
they are given explicitly.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">MIMETYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;CSV&#39;</span><span class="p">:</span> <span class="s">&#39;text/csv&#39;</span><span class="p">,</span>
    <span class="s">&#39;TSV&#39;</span><span class="p">:</span> <span class="s">&#39;text/tab-separated-values&#39;</span><span class="p">,</span>
    <span class="s">&#39;TAB&#39;</span><span class="p">:</span> <span class="s">&#39;text/tab-separated-values&#39;</span><span class="p">,</span>
    <span class="s">&#39;DOC&#39;</span><span class="p">:</span> <span class="s">&#39;application/msword&#39;</span><span class="p">,</span>
    <span class="s">&#39;DOCX&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;application/vnd.openxmlformats-officedocument.&#39;</span>
             <span class="s">&#39;wordprocessingml.document&#39;</span><span class="p">),</span>
    <span class="s">&#39;ODS&#39;</span><span class="p">:</span> <span class="s">&#39;application/x-vnd.oasis.opendocument.spreadsheet&#39;</span><span class="p">,</span>
    <span class="s">&#39;ODT&#39;</span><span class="p">:</span> <span class="s">&#39;application/vnd.oasis.opendocument.text&#39;</span><span class="p">,</span>
    <span class="s">&#39;RTF&#39;</span><span class="p">:</span> <span class="s">&#39;application/rtf&#39;</span><span class="p">,</span>
    <span class="s">&#39;SXW&#39;</span><span class="p">:</span> <span class="s">&#39;application/vnd.sun.xml.writer&#39;</span><span class="p">,</span>
    <span class="s">&#39;TXT&#39;</span><span class="p">:</span> <span class="s">&#39;text/plain&#39;</span><span class="p">,</span>
    <span class="s">&#39;XLS&#39;</span><span class="p">:</span> <span class="s">&#39;application/vnd.ms-excel&#39;</span><span class="p">,</span>
    <span class="s">&#39;XLSX&#39;</span><span class="p">:</span> <span class="s">&#39;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#39;</span><span class="p">,</span>
    <span class="s">&#39;PDF&#39;</span><span class="p">:</span> <span class="s">&#39;application/pdf&#39;</span><span class="p">,</span>
    <span class="s">&#39;PNG&#39;</span><span class="p">:</span> <span class="s">&#39;image/png&#39;</span><span class="p">,</span>
    <span class="s">&#39;PPT&#39;</span><span class="p">:</span> <span class="s">&#39;application/vnd.ms-powerpoint&#39;</span><span class="p">,</span>
    <span class="s">&#39;PPS&#39;</span><span class="p">:</span> <span class="s">&#39;application/vnd.ms-powerpoint&#39;</span><span class="p">,</span>
    <span class="s">&#39;HTM&#39;</span><span class="p">:</span> <span class="s">&#39;text/html&#39;</span><span class="p">,</span>
    <span class="s">&#39;HTML&#39;</span><span class="p">:</span> <span class="s">&#39;text/html&#39;</span><span class="p">,</span>
    <span class="s">&#39;ZIP&#39;</span><span class="p">:</span> <span class="s">&#39;application/zip&#39;</span><span class="p">,</span>
    <span class="s">&#39;SWF&#39;</span><span class="p">:</span> <span class="s">&#39;application/x-shockwave-flash&#39;</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Constructor.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">DocsClient</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s">&#39;GoogleCL&#39;</span><span class="p">)</span>
    <span class="n">googlecl</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">BaseClientCL</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SECTION_HEADER</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Wrapper function to mesh with DocsBaseCL.upload_docs().</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_create_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">folder_or_uri</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">FOLDER_LABEL</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                       <span class="n">folder_or_uri</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_determine_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_ext</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">DocsClientCL</span><span class="o">.</span><span class="n">MIMETYPES</span><span class="p">[</span><span class="n">file_ext</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
      <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;No supported filetype found for extension </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">file_ext</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Downloads a file, optionally decoding from UTF-8.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">auth_token</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Overridden from gdata.docs.client to support decoding.</p>
<p>Args:
  uri: string The full Export URL to download the file from.
  file_path: string The full path to save the file to.
  auth_token: (optional) gdata.gauth.ClientLoginToken, AuthSubToken, or
      OAuthToken which authorizes this client to edit the user's data.
  decode: bool (default False) Whether or not to decode UTF-8.
  kwargs: Other parameters to pass to self.get_file_content().</p>
<p>Raises:
  RequestError: on error response from server.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">response_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_file_content</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">auth_token</span><span class="o">=</span><span class="n">auth_token</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">can_export</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="ow">and</span>\
       <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="n">SECTION_HEADER</span><span class="p">,</span> <span class="s">&#39;decode_utf_8&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">file_string</span> <span class="o">=</span> <span class="n">response_string</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8-sig&#39;</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Could not decode: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
        <span class="n">file_string</span> <span class="o">=</span> <span class="n">response_string</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">file_string</span> <span class="o">=</span> <span class="n">response_string</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">download_file</span><span class="p">:</span>
      <span class="n">download_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_string</span><span class="p">)</span>
      <span class="n">download_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Exports a document from the Document List in a different format.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry_or_id_or_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">gid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">auth_token</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Overloaded from docs.client.DocsClient to fix "always-download-as-pdf"
issue</p>
<p>Args:
  entry_or_id_or_url: gdata.data.GDEntry or string representing a
      resource id or URL to download the document from (such as the content
      src link).
  file_path: str The full path to save the file to.  The export
      format is inferred from the the file extension.
  gid: str (optional) grid id for downloading a single grid of a
      spreadsheet. The param should only be used for .csv and .tsv
      spreadsheet exports.
  auth_token: (optional) gdata.gauth.ClientLoginToken, AuthSubToken, or
      OAuthToken which authorizes this client to edit the user's data.
  kwargs: Other parameters to pass to self.download().</p>
<p>Raises:
  gdata.client.RequestError if the download URL is malformed or the server's
  response was not successful.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">extra_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">match</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">FILE_EXT_PATTERN</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
      <span class="n">export_format</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Hack for apps-api-issues Issue 2294</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="n">export_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;html&#39;</span><span class="p">:</span>
        <span class="n">export_format</span> <span class="o">=</span> <span class="s">&#39;102&#39;</span>
      <span class="n">extra_params</span><span class="p">[</span><span class="s">&#39;exportFormat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_format</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Fix issue with new-style docs always downloading to PDF
(gdata-issues Issue 2157)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">extra_params</span><span class="p">[</span><span class="s">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_format</span>

    <span class="k">if</span> <span class="n">gid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">extra_params</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gid</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">entry_or_id_or_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">extra_params</span><span class="p">,</span>
                  <span class="n">auth_token</span><span class="o">=</span><span class="n">auth_token</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="n">Export</span> <span class="o">=</span> <span class="n">export</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Get a list of document entries from a feed.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_doclist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">folder_entry_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Keyword arguments:
  titles: list or string Title(s) of entries to return. Will be compared
         to entry.title.text, using regular expressions if self.use_regex.
         Default None for all entries from feed.
  folder_entry_list: List of GDataEntry's of folders to get from.
         Only files found in these folders will be returned.
         Default None for all folders.</p>
<p>Returns:
  List of entries.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">folder_entry_list</span><span class="p">:</span>
      <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folder_entry_list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>folder.content.src is the uri to query for documents in that folder.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">src</span><span class="p">,</span>
                                       <span class="n">titles</span><span class="p">,</span>
                                       <span class="n">desired_class</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DocList</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">DOCLIST_FEED_URI</span><span class="p">,</span>
                                <span class="n">titles</span><span class="p">,</span>
                                <span class="n">desired_class</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DocList</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Return exactly one doc_entry.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_single_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">folder_entry_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Keyword arguments:
  title: Title to match on for document. Default None for any title.
  folder_entry_list: GDataEntry of folders to look in.
                     Default None for any folder.</p>
<p>Returns:
  None if there were no matches, or one entry matching the given title.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">folder_entry_list</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">folder_entry_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSingleEntry</span><span class="p">(</span><span class="n">folder_entry_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">src</span><span class="p">,</span>
                                   <span class="n">title</span><span class="p">,</span>
                                   <span class="n">desired_class</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DocList</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_doclist</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">folder_entry_list</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Technically don't need the desired_class for this call
because we have the entries.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSingleEntry</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSingleEntry</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">DOCLIST_FEED_URI</span><span class="p">,</span>
                                 <span class="n">title</span><span class="p">,</span>
                                 <span class="n">desired_class</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DocList</span><span class="p">)</span>

  <span class="n">GetSingleDoc</span> <span class="o">=</span> <span class="n">get_single_doc</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Return entries for one or more folders.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Keyword arguments:
  title: Title of the folder.</p>
<p>Returns:
  GDataEntry representing a folder, or None of title is None.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
      <span class="n">uri</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">DOCLIST_FEED_URI</span> <span class="o">+</span> <span class="s">&#39;-/folder&#39;</span>
      <span class="n">folder_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_entries</span><span class="p">:</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;No folder found that matches &#39;</span> <span class="o">+</span> <span class="n">title</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">folder_entries</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span>

  <span class="n">GetFolder</span> <span class="o">=</span> <span class="n">get_folder</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>Check that the token being used is valid.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">is_token_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_uri</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_uri</span><span class="p">:</span>
      <span class="n">docs_uri</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">DOCLIST_FEED_URI</span>
      <span class="n">sheets_uri</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;https://spreadsheets.google.com/feeds/spreadsheets&#39;</span>
                    <span class="s">&#39;/private/full&#39;</span><span class="p">)</span>
    <span class="n">docs_test</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">BaseClientCL</span><span class="o">.</span><span class="n">IsTokenValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs_uri</span><span class="p">)</span>
    <span class="n">sheets_test</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">BaseClientCL</span><span class="o">.</span><span class="n">IsTokenValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheets_uri</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">docs_test</span> <span class="ow">and</span> <span class="n">sheets_test</span>

  <span class="n">IsTokenValid</span> <span class="o">=</span> <span class="n">is_token_valid</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Replace content of a DocEntry.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_modify_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_entry</span><span class="p">,</span> <span class="n">path_to_new_content</span><span class="p">,</span> <span class="n">file_ext</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>Args:
  doc_entry: DocEntry whose content will be replaced.
  path_to_new_content: str Path to file that has new content.
  file_ext: str Extension to use to determine MIME type of upload
            (e.g. 'txt', 'doc')</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="kn">from</span> <span class="nn">gdata.docs.data</span> <span class="kn">import</span> <span class="n">MIMETYPES</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">content_type</span> <span class="o">=</span> <span class="n">MIMETYPES</span><span class="p">[</span><span class="n">file_ext</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;Could not find mimetype for &#39;</span> <span class="o">+</span> <span class="n">file_ext</span>
      <span class="k">while</span> <span class="n">file_ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MIMETYPES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">file_ext</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Please enter one of &#39;</span> <span class="o">+</span>
                                <span class="n">MIMETYPES</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">+</span>
                                <span class="s">&#39; to determine the content type to upload as.&#39;</span><span class="p">)</span>
      <span class="n">content_type</span> <span class="o">=</span> <span class="n">MIMETYPES</span><span class="p">[</span><span class="n">file_ext</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="n">mediasource</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MediaSource</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">path_to_new_content</span><span class="p">,</span>
                                         <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">doc_entry</span><span class="p">,</span> <span class="n">media_source</span><span class="o">=</span><span class="n">mediasource</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Request access as in BaseClientCL, but specify scopes.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">request_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">display_name</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">browser</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>When people use docs (writely), they expect access to
spreadsheets as well (wise).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">scopes</span><span class="p">:</span>
      <span class="n">scopes</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">gauth</span><span class="o">.</span><span class="n">AUTH_SCOPES</span><span class="p">[</span><span class="s">&#39;writely&#39;</span><span class="p">]</span> <span class="o">+</span>\
               <span class="n">gdata</span><span class="o">.</span><span class="n">gauth</span><span class="o">.</span><span class="n">AUTH_SCOPES</span><span class="p">[</span><span class="s">&#39;wise&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">BaseClientCL</span><span class="o">.</span><span class="n">request_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span>
                                                       <span class="n">display_name</span><span class="p">,</span>
                                                       <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
                                                       <span class="n">browser</span><span class="o">=</span><span class="n">browser</span><span class="p">)</span>

  <span class="n">RequestAccess</span> <span class="o">=</span> <span class="n">request_access</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Upload a document.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_transmit_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">entry_title</span><span class="p">,</span> <span class="n">post_uri</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">file_ext</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>The final step in uploading a document. The process differs between versions
of the gdata python client library, hence its definition here.</p>
<p>Args:
  path: Path to the file to upload.
  entry_title: Name of the document.
  post_uri: URI to make request to.
  content_type: MIME type of request.
  file_ext: File extension that determined the content_type.</p>
<p>Returns:
  Entry representing the document uploaded.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>GoogleCL that uses gdata-2.0.0 through 2.0.4 won't ever see this code.
If it uses gdata-2.0.5 through 2.0.7, it would otherwise give an error 
about a resumable uploader that it doesn't have. This avoids that error.
If it uses gdata-2.0.8, 2.0.9, or 2.0.11 it can't upload docs due to an SSL error.
If it uses gdata-2.0.10, 2.0.12, 2.0.13, 2.0.14 this should allow it to 
upload all allowable file types.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">client</span><span class="p">,</span><span class="s">&quot;ResumableUploader&quot;</span><span class="p">):</span>
      <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
      <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      <span class="n">uploader</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ResumableUploader</span><span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">file_size</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1048576</span><span class="p">,</span>
          <span class="n">desired_class</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">GDEntry</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Set metadata for our upload.  </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">entry</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">GDEntry</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Title</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">entry_title</span><span class="p">))</span>
      <span class="n">new_entry</span> <span class="o">=</span> <span class="n">uploader</span><span class="o">.</span><span class="n">UploadFile</span><span class="p">(</span><span class="s">&#39;/feeds/upload/create-session/default/private/full&#39;</span><span class="p">,</span> <span class="n">entry</span><span class="o">=</span><span class="n">entry</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>These might be useful for a verbose debug statement:
print 'Document uploaded: ' + new_entry.title.text
print 'Quota used: %s' % new_entry.quota_bytes_used.text</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
      <span class="k">return</span> <span class="n">new_entry</span>
      
    <span class="k">else</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>If we have reached this point, we must be in gdata-2.0.5 through 2.0.7
The upload is guaranteed to fail, so the self.upload call is here to
return whatever the caller wanted.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">entry_title</span><span class="p">,</span> <span class="n">post_uri</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
      
<span class="n">SERVICE_CLASS</span> <span class="o">=</span> <span class="n">DocsClientCL</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
