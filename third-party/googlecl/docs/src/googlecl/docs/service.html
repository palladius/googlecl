<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>service.py</title>
  <link rel="stylesheet" href="../../../pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>service.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Copyright (C) 2010 Google Inc.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<pre><code> http://www.apache.org/licenses/LICENSE-2.0
</code></pre>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
Service details and instances for the Docs service.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Some use cases:
Upload a document:
  docs upload --folder "Some folder" path_to_doc</p>
<p>Edit a document in your word editor:
  docs edit --title "Grocery List" --editor vim (editor also set in prefs)</p>
<p>Download docs:
  docs get --folder "Some folder"</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">with_statement</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;tom.h.miller@gmail.com (Tom Miller)&#39;</span>
<span class="kn">import</span> <span class="nn">gdata.docs.service</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">googlecl</span>
<span class="kn">import</span> <span class="nn">googlecl.base</span>
<span class="kn">import</span> <span class="nn">googlecl.service</span>
<span class="kn">from</span> <span class="nn">googlecl.docs</span> <span class="kn">import</span> <span class="n">SECTION_HEADER</span>
<span class="kn">import</span> <span class="nn">googlecl.docs.base</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Renamed here to reduce verbosity in other sections</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">safe_encode</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">safe_encode</span>
<span class="n">safe_decode</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">safe_decode</span>


<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">LOGGER_NAME</span> <span class="o">+</span> <span class="s">&#39;.service&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Extends gdata.docs.service.DocsClient for the command line.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">DocsServiceCL</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">DocsService</span><span class="p">,</span>
                    <span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">DocsBaseCL</span><span class="p">,</span>
                    <span class="n">googlecl</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">BaseServiceCL</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>This class adds some features focused on using Google Docs via an installed
app with a command line interface.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">DOCLIST_FEED_URI</span> <span class="o">=</span> <span class="s">&#39;/feeds/documents/private/full&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Constructor.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">DocsService</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s">&#39;GoogleCL&#39;</span><span class="p">)</span>
    <span class="n">googlecl</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">BaseServiceCL</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SECTION_HEADER</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>302 Moved Temporarily errors began cropping up for new style docs
during export. Using https solves the problem, so set ssl True here.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="bp">self</span><span class="o">.</span><span class="n">ssl</span> <span class="o">=</span> <span class="bp">True</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Downloads a file.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_DownloadFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Overloaded from docs.service.DocsService to optionally decode from UTF.</p>
<p>Args:
  uri: string The full Export URL to download the file from.
  file_path: string The full path to save the file to.</p>
<p>Raises:
  RequestError: on error response from server.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">server_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span>
    <span class="n">response_body</span> <span class="o">=</span> <span class="n">server_response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">server_response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">gdata</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">RequestError</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="n">server_response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                                         <span class="s">&#39;reason&#39;</span><span class="p">:</span> <span class="n">server_response</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span>
                                         <span class="s">&#39;body&#39;</span><span class="p">:</span> <span class="n">response_body</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">can_export</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="ow">and</span>\
       <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="n">SECTION_HEADER</span><span class="p">,</span> <span class="s">&#39;decode_utf_8&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">file_string</span> <span class="o">=</span> <span class="n">response_body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8-sig&#39;</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Could not decode: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
        <span class="n">file_string</span> <span class="o">=</span> <span class="n">response_body</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">file_string</span> <span class="o">=</span> <span class="n">response_body</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">download_file</span><span class="p">:</span>
      <span class="n">download_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_string</span><span class="p">)</span>
      <span class="n">download_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Stolen from gdata-2.0.10 to make recursive directory upload work.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_create_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">folder_or_uri</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">try</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">DocsService</span><span class="o">.</span><span class="n">CreateFolder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                                                         <span class="n">folder_or_uri</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
      <span class="kn">import</span> <span class="nn">atom</span>
      <span class="k">if</span> <span class="n">folder_or_uri</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="n">uri</span> <span class="o">=</span> <span class="n">folder_or_uri</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">src</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
          <span class="n">uri</span> <span class="o">=</span> <span class="n">folder_or_uri</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s">&#39;/feeds/documents/private/full&#39;</span>

      <span class="n">folder_entry</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">DocumentListEntry</span><span class="p">()</span>
      <span class="n">folder_entry</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">Title</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
      <span class="n">folder_entry</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_make_kind_category</span><span class="p">(</span>
                                               <span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">FOLDER_LABEL</span><span class="p">))</span>
      <span class="n">folder_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Post</span><span class="p">(</span><span class="n">folder_entry</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span>
                               <span class="n">converter</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">DocumentListEntryFromString</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">folder_entry</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_determine_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_ext</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">gdata.docs.service</span> <span class="kn">import</span> <span class="n">SUPPORTED_FILETYPES</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">SUPPORTED_FILETYPES</span><span class="p">[</span><span class="n">file_ext</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
      <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;No supported filetype found for extension </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">file_ext</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Export old and new version docs.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry_or_id_or_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">gid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extra_params</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Ripped from gdata.docs.DocsService, adds 'format' parameter to make
new version documents happy.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">ext</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">get_extension_from_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">extra_params</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">extra_params</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Fix issue with new-style docs always downloading to PDF
(gdata-issues Issue 2157)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">extra_params</span><span class="p">[</span><span class="s">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ext</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Download</span><span class="p">(</span><span class="n">entry_or_id_or_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">extra_params</span><span class="p">)</span>

  <span class="n">Export</span> <span class="o">=</span> <span class="n">export</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Get a list of document entries from a feed.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_doclist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">folder_entry_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Keyword arguments:
  titles: list or string Title(s) of entries to return. Will be compared
         to entry.title.text, using regular expressions if self.use_regex.
         Default None for all entries from feed.
  folder_entry_list: List of GDataEntry's of folders to get from.
         Only files found in these folders will be returned.
         Default None for all folders.</p>
<p>Returns:
  List of entries.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">folder_entry_list</span><span class="p">:</span>
      <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folder_entry_list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>folder.content.src is the uri to query for documents in that folder.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">src</span><span class="p">,</span>
                                       <span class="n">titles</span><span class="p">,</span>
                               <span class="n">converter</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">DocumentListFeedFromString</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">DocumentQuery</span><span class="p">()</span>
      <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">ToUri</span><span class="p">(),</span>
                                <span class="n">titles</span><span class="p">,</span>
                                <span class="n">converter</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">DocumentListFeedFromString</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Return exactly one doc_entry.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_single_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">folder_entry_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Keyword arguments:
  title: Title to match on for document. Default None for any title.
  folder_entry_list: GDataEntry of folders to look in.
                     Default None for any folder.</p>
<p>Returns:
  None if there were no matches, or one entry matching the given title.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">folder_entry_list</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">folder_entry_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSingleEntry</span><span class="p">(</span><span class="n">folder_entry_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">src</span><span class="p">,</span>
                                   <span class="n">title</span><span class="p">,</span>
                                <span class="n">converter</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">DocumentListFeedFromString</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_doclist</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">folder_entry_list</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Technically don't need the converter for this call
because we have the entries.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSingleEntry</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSingleEntry</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">DocumentQuery</span><span class="p">()</span><span class="o">.</span><span class="n">ToUri</span><span class="p">(),</span>
                                 <span class="n">title</span><span class="p">,</span>
                                <span class="n">converter</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">DocumentListFeedFromString</span><span class="p">)</span>

  <span class="n">GetSingleDoc</span> <span class="o">=</span> <span class="n">get_single_doc</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Return entries for one or more folders.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Keyword arguments:
  title: Title of the folder.</p>
<p>Returns:
  GDataEntry representing a folder, or None of title is None.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
      <span class="n">query</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">DocumentQuery</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;folder&#39;</span><span class="p">],</span>
                                               <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;showfolders&#39;</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">})</span>
      <span class="n">folder_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">ToUri</span><span class="p">(),</span> <span class="n">title</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_entries</span><span class="p">:</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;No folder found that matches &#39;</span> <span class="o">+</span> <span class="n">title</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">folder_entries</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span>

  <span class="n">GetFolder</span> <span class="o">=</span> <span class="n">get_folder</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>Check that the token being used is valid.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">is_token_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_uri</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_uri</span><span class="p">:</span>
      <span class="n">docs_uri</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">DocumentQuery</span><span class="p">()</span><span class="o">.</span><span class="n">ToUri</span><span class="p">()</span>
      <span class="n">sheets_uri</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;https://spreadsheets.google.com/feeds/spreadsheets&#39;</span>
                    <span class="s">&#39;/private/full&#39;</span><span class="p">)</span>
    <span class="n">docs_test</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">BaseServiceCL</span><span class="o">.</span><span class="n">IsTokenValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs_uri</span><span class="p">)</span>
    <span class="n">sheets_test</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">BaseServiceCL</span><span class="o">.</span><span class="n">IsTokenValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheets_uri</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">docs_test</span> <span class="ow">and</span> <span class="n">sheets_test</span>

  <span class="n">IsTokenValid</span> <span class="o">=</span> <span class="n">is_token_valid</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Replace content of a DocEntry.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_modify_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_entry</span><span class="p">,</span> <span class="n">path_to_new_content</span><span class="p">,</span> <span class="n">file_ext</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>Args:
  doc_entry: DocEntry whose content will be replaced.
  path_to_new_content: str Path to file that has new content.
  file_ext: str Extension to use to determine MIME type of upload
            (e.g. 'txt', 'doc')</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="kn">from</span> <span class="nn">gdata.docs.service</span> <span class="kn">import</span> <span class="n">SUPPORTED_FILETYPES</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">content_type</span> <span class="o">=</span> <span class="n">SUPPORTED_FILETYPES</span><span class="p">[</span><span class="n">file_ext</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;Could not find mimetype for &#39;</span> <span class="o">+</span> <span class="n">file_ext</span>
      <span class="k">while</span> <span class="n">file_ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SUPPORTED_FILETYPES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">file_ext</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Please enter one of &#39;</span> <span class="o">+</span>
                                <span class="n">SUPPORTED_FILETYPES</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">+</span>
                                <span class="s">&#39; for a content type to upload as.&#39;</span><span class="p">)</span>
      <span class="n">content_type</span> <span class="o">=</span> <span class="n">SUPPORTED_FILETYPES</span><span class="p">[</span><span class="n">file_ext</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="n">mediasource</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">MediaSource</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">path_to_new_content</span><span class="p">,</span>
                                    <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Put</span><span class="p">(</span><span class="n">mediasource</span><span class="p">,</span> <span class="n">doc_entry</span><span class="o">.</span><span class="n">GetEditMediaLink</span><span class="p">()</span><span class="o">.</span><span class="n">href</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Request access as in BaseServiceCL, but specify scopes.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">request_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">display_name</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">browser</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>When people use docs (writely), they expect access to
spreadsheets as well (wise).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">scopes</span><span class="p">:</span>
      <span class="n">scopes</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">CLIENT_LOGIN_SCOPES</span><span class="p">[</span><span class="s">&#39;writely&#39;</span><span class="p">]</span> <span class="o">+</span>\
               <span class="n">gdata</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">CLIENT_LOGIN_SCOPES</span><span class="p">[</span><span class="s">&#39;wise&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">BaseServiceCL</span><span class="o">.</span><span class="n">request_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span>
                                                         <span class="n">display_name</span><span class="p">,</span>
                                                         <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
                                                         <span class="n">browser</span><span class="o">=</span><span class="n">browser</span><span class="p">)</span>

  <span class="n">RequestAccess</span> <span class="o">=</span> <span class="n">request_access</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Upload a document.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">_transmit_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">entry_title</span><span class="p">,</span> <span class="n">post_uri</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">file_ext</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>The final step in uploading a document. The process differs between versions
of the gdata python client library, hence its definition here.</p>
<p>Args:
  path: Path to the file to upload.
  entry_title: Name of the document.
  post_uri: URI to make request to.
  content_type: MIME type of request.
  file_ext: File extension that determined the content_type.</p>
<p>Returns:
  Entry representing the document uploaded.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">media</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">MediaSource</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>Upload() wasn't added until later versions of DocsService, so
we may not have it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Upload</span><span class="p">(</span><span class="n">media</span><span class="p">,</span> <span class="n">entry_title</span><span class="p">,</span> <span class="n">post_uri</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
      <span class="kn">import</span> <span class="nn">atom</span>
      <span class="n">entry</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">DocumentListEntry</span><span class="p">()</span>
      <span class="n">entry</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">Title</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">entry_title</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Cover the supported filetypes in gdata-2.0.10 even though
they aren't listed in gdata 1.2.4... see what happens.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;csv&#39;</span><span class="p">,</span> <span class="s">&#39;tsv&#39;</span><span class="p">,</span> <span class="s">&#39;tab&#39;</span><span class="p">,</span> <span class="s">&#39;ods&#39;</span><span class="p">,</span> <span class="s">&#39;xls&#39;</span><span class="p">,</span> <span class="s">&#39;xlsx&#39;</span><span class="p">]:</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">_make_kind_category</span><span class="p">(</span><span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">SPREADSHEET_LABEL</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;ppt&#39;</span><span class="p">,</span> <span class="s">&#39;pps&#39;</span><span class="p">]:</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">_make_kind_category</span><span class="p">(</span><span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">PRESENTATION_LABEL</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;pdf&#39;</span><span class="p">]:</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">_make_kind_category</span><span class="p">(</span><span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">PDF_LABEL</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>Treat everything else as a document</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">else</span><span class="p">:</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">_make_kind_category</span><span class="p">(</span><span class="n">googlecl</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">DOCUMENT_LABEL</span><span class="p">)</span>
      <span class="n">entry</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>To support uploading to folders for earlier
versions of the API, expose the lower-level Post</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Post</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">post_uri</span><span class="p">,</span> <span class="n">media_source</span><span class="o">=</span><span class="n">media</span><span class="p">,</span>
                       <span class="n">extra_headers</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Slug&#39;</span><span class="p">:</span> <span class="n">media</span><span class="o">.</span><span class="n">file_name</span><span class="p">},</span>
                       <span class="n">converter</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">DocumentListEntryFromString</span><span class="p">)</span>


<span class="n">SERVICE_CLASS</span> <span class="o">=</span> <span class="n">DocsServiceCL</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>Stolen from gdata-2.0.10 docs.service.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_make_kind_category</span><span class="p">(</span><span class="n">label</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kn">import</span> <span class="nn">atom</span>
  <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">None</span>
  <span class="n">documents_namespace</span> <span class="o">=</span> <span class="s">&#39;http://schemas.google.com/docs/2007&#39;</span>
  <span class="k">return</span> <span class="n">atom</span><span class="o">.</span><span class="n">Category</span><span class="p">(</span><span class="n">scheme</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">DATA_KIND_SCHEME</span><span class="p">,</span>
                       <span class="n">term</span><span class="o">=</span><span class="n">documents_namespace</span> <span class="o">+</span> <span class="s">&#39;#&#39;</span> <span class="o">+</span> <span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
