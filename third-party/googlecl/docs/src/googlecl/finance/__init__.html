<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>__init__.py</title>
  <link rel="stylesheet" href="../../../pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>__init__.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Copyright (C) 2010 Google Inc.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<pre><code> http://www.apache.org/licenses/LICENSE-2.0
</code></pre>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">googlecl</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">googlecl.base</span> <span class="kn">import</span> <span class="n">Task</span>


<span class="n">safe_encode</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">safe_encode</span>
<span class="n">service_name</span> <span class="o">=</span> <span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">LOGGER_NAME</span> <span class="o">=</span> <span class="n">__name__</span>
<span class="n">SECTION_HEADER</span> <span class="o">=</span> <span class="n">service_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">LOGGER_NAME</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Base class for formatters.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">BaseFormatter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Init formatter</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avail_fields</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Args:
  avail_fields: list of tuples [(field_name, format_spec), ...] for all
                possible fields
  fields: string, list of <sep>-separated requested fields names.
  sep: string, separator, comma by default</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">avail_fields</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">avail_fields</span> <span class="o">=</span> <span class="n">avail_fields</span>
    <span class="n">avail_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">avail_fields</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">avail_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Make output header.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Uses names of available fields as column headers. replaces
'_' with ' ' and capitalizes them. Utilizes the same format as
used for body lines: self.format</p>
<p>Returns: string, header.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">%</span> \
        <span class="nb">dict</span><span class="p">([(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span> \
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">avail_fields</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Get formatted entry. Abstract method.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Args:
  entry: entry object
Returns:
  string, formatted entry.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Abstract method </span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s"> called&quot;</span> <span class="o">%</span> \
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                 <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Output list of entries to the output stream.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Args:
  entries: list of entries.
  stream: output stream.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
      <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
      <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_line</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">PortfolioFormatter</span><span class="p">(</span><span class="n">BaseFormatter</span><span class="p">):</span>
  <span class="n">avail_fields</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(id)3s</span><span class="s">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(title)-15s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;curr&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(curr)-4s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;gain&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(gain)-10s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;gain_persent&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(gain_persent)-14s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;cost_basis&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(cost_basis)-10s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;days_gain&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(days_gain)-10s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;market_value&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(market_value)-10s</span><span class="s">&#39;</span><span class="p">)]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avail_fields</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span>  <span class="n">entry</span><span class="o">.</span><span class="n">portfolio_data</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">%</span> \
      <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">portfolio_id</span><span class="p">,</span> <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">portfolio_title</span><span class="p">,</span>
       <span class="s">&#39;curr&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">currency_code</span><span class="p">,</span>
       <span class="s">&#39;gain&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">gain</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">gain</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
       <span class="s">&#39;gain_persent&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%-14.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gain_percentage</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,),</span>
       <span class="s">&#39;cost_basis&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">cost_basis</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">cost_basis</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
       <span class="s">&#39;days_gain&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">days_gain</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">days_gain</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
       <span class="s">&#39;market_value&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">market_value</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">market_value</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span>
      <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">PositionFormatter</span><span class="p">(</span><span class="n">BaseFormatter</span><span class="p">):</span>
  <span class="n">avail_fields</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;ticker&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(ticker)-14s</span><span class="s">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;shares&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(shares)-10s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;gain&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(gain)-10s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;gain_persent&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(gain_persent)-14s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;cost_basis&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(cost_basis)-10s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;days_gain&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(days_gain)-10s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;market_value&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(market_value)-10s</span><span class="s">&#39;</span><span class="p">)]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avail_fields</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span>  <span class="n">entry</span><span class="o">.</span><span class="n">position_data</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">%</span> \
      <span class="p">{</span><span class="s">&#39;ticker&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">ticker_id</span><span class="p">,</span> <span class="s">&#39;shares&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">shares</span><span class="p">,</span>
       <span class="s">&#39;gain&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">gain</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">gain</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
       <span class="s">&#39;gain_persent&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%-14.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gain_percentage</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,),</span>
       <span class="s">&#39;cost_basis&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">cost_basis</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">cost_basis</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
       <span class="s">&#39;days_gain&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">days_gain</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">days_gain</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
       <span class="s">&#39;market_value&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">market_value</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">market_value</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span>
      <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">TransactionFormatter</span><span class="p">(</span><span class="n">BaseFormatter</span><span class="p">):</span>
  <span class="n">avail_fields</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(id)-3s</span><span class="s">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(type)-12s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;shares&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(shares)-10s</span><span class="s">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;price&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(price)-10s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;commission&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(commission)-10s</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;date&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(date)-10s</span><span class="s">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;notes&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(notes)-30s</span><span class="s">&#39;</span><span class="p">)]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avail_fields</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">transaction_data</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
      <span class="n">data</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">date</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="c"># stip isoformat tail</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">%</span> \
      <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">transaction_id</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s">&#39;shares&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">shares</span><span class="p">,</span>
       <span class="s">&#39;price&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
       <span class="s">&#39;commission&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">commission</span><span class="o">.</span><span class="n">money</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
       <span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">date</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;notes&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">notes</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>===============================================================================
Each of the following <em>run</em>* functions execute a particular task.</p>
<p>Keyword arguments:
 client: Client to the service being used.
 options: Contains all attributes required to perform the task
 args: Additional arguments passed in on the command line, may or may not be
       required
===============================================================================
Portfolio-related tasks</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_run_create</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
  <span class="n">client</span><span class="o">.</span><span class="n">CreatePortfolio</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_run_delete</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
  <span class="n">entries</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_portfolio_entries</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">entries</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">DeleteEntryList</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="s">&#39;portfolio&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">prompt</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_run_list</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
  <span class="n">entries</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_portfolio_entries</span><span class="p">(</span><span class="n">returns</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">entries</span><span class="p">:</span>
    <span class="n">PortfolioFormatter</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;No portfolios found&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Position-related tasks</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_run_create_position</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>Quote from Developer's Guide:
  You can't directly create, update, or delete position entries;
  positions are derived from transactions.
  Therefore, to create or modify a position, send appropriate
  transactions on that position.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">pfl</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_portfolio</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">pfl</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>create empty transaction</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">client</span><span class="o">.</span><span class="n">create_transaction</span><span class="p">(</span><span class="n">pfl</span><span class="p">,</span> <span class="s">&quot;Buy&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">ticker</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_run_delete_positions</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
  <span class="n">positions</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_positions</span><span class="p">(</span><span class="n">portfolio_title</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                                   <span class="n">ticker_id</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">ticker</span><span class="p">)</span>
  <span class="n">client</span><span class="o">.</span><span class="n">DeleteEntryList</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="s">&#39;position&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span>
                 <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pos</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">DeletePosition</span><span class="p">(</span><span class="n">position_entry</span><span class="o">=</span><span class="n">pos</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_run_list_positions</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
  <span class="n">positions</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_positions</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span>
                                   <span class="n">include_returns</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">positions</span><span class="p">:</span>
    <span class="n">PositionFormatter</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;No positions found in this portfolio&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Transaction-related tasks</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_run_create_transaction</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
  <span class="n">pfl</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_portfolio</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">pfl</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">create_transaction</span><span class="p">(</span><span class="n">pfl</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">ttype</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span>
                              <span class="n">options</span><span class="o">.</span><span class="n">shares</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">price</span><span class="p">,</span>
                              <span class="n">options</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">commission</span><span class="p">,</span>
                              <span class="n">options</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">notes</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_run_delete_transactions</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
  <span class="n">transactions</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_transactions</span><span class="p">(</span><span class="n">portfolio_title</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                                         <span class="n">ticker_id</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span>
                                         <span class="n">transaction_id</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">txnid</span><span class="p">)</span>
  <span class="n">client</span><span class="o">.</span><span class="n">DeleteEntryList</span><span class="p">(</span><span class="n">transactions</span><span class="p">,</span> <span class="s">&#39;transaction&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">prompt</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_run_list_transactions</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
  <span class="n">transactions</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_transactions</span><span class="p">(</span><span class="n">portfolio_title</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                                         <span class="n">ticker_id</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span>
                                         <span class="n">transaction_id</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">txnid</span><span class="p">)</span>
  <span class="n">TransactionFormatter</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">transactions</span><span class="p">)</span>


<span class="n">TASKS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;create&#39;</span><span class="p">:</span> <span class="n">Task</span><span class="p">(</span><span class="s">&#39;Create a portfolio&#39;</span><span class="p">,</span>
                        <span class="n">callback</span><span class="o">=</span><span class="n">_run_create</span><span class="p">,</span>
                        <span class="n">required</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;currency&#39;</span><span class="p">]),</span>
         <span class="s">&#39;delete&#39;</span><span class="p">:</span> <span class="n">Task</span><span class="p">(</span><span class="s">&#39;Delete portfolios&#39;</span><span class="p">,</span>
                        <span class="n">callback</span><span class="o">=</span><span class="n">_run_delete</span><span class="p">,</span>
                        <span class="n">required</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]),</span>
         <span class="s">&#39;list&#39;</span><span class="p">:</span>   <span class="n">Task</span><span class="p">(</span><span class="s">&#39;List portfolios&#39;</span><span class="p">,</span>
                        <span class="n">callback</span><span class="o">=</span><span class="n">_run_list</span><span class="p">,</span>
                        <span class="n">optional</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">]),</span>
         <span class="s">&#39;create-pos&#39;</span><span class="p">:</span> <span class="n">Task</span><span class="p">(</span><span class="s">&#39;Create position&#39;</span><span class="p">,</span>
                            <span class="n">callback</span><span class="o">=</span><span class="n">_run_create_position</span><span class="p">,</span>
                            <span class="n">required</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;ticker&#39;</span><span class="p">]),</span>
         <span class="s">&#39;delete-pos&#39;</span><span class="p">:</span> <span class="n">Task</span><span class="p">(</span><span class="s">&#39;Delete positions&#39;</span><span class="p">,</span>
                            <span class="n">callback</span><span class="o">=</span><span class="n">_run_delete_positions</span><span class="p">,</span>
                            <span class="n">required</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span>
                            <span class="n">optional</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ticker&#39;</span><span class="p">]),</span>
         <span class="s">&#39;list-pos&#39;</span><span class="p">:</span>  <span class="n">Task</span><span class="p">(</span><span class="s">&#39;List positions&#39;</span><span class="p">,</span>
                           <span class="n">callback</span><span class="o">=</span><span class="n">_run_list_positions</span><span class="p">,</span>
                           <span class="n">required</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span>
                           <span class="n">optional</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">]),</span>
         <span class="s">&#39;create-txn&#39;</span><span class="p">:</span> <span class="n">Task</span><span class="p">(</span><span class="s">&#39;Create transaction&#39;</span><span class="p">,</span>
                            <span class="n">callback</span><span class="o">=</span><span class="n">_run_create_transaction</span><span class="p">,</span>
                            <span class="n">required</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;ticker&#39;</span><span class="p">,</span> <span class="s">&#39;ttype&#39;</span><span class="p">,</span>
                                      <span class="s">&#39;shares&#39;</span><span class="p">,</span> <span class="s">&#39;price&#39;</span><span class="p">],</span>
                            <span class="n">optional</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;shares&#39;</span><span class="p">,</span> <span class="s">&#39;price&#39;</span><span class="p">,</span> <span class="s">&#39;date&#39;</span><span class="p">,</span>
                                      <span class="s">&#39;commission&#39;</span><span class="p">,</span> <span class="s">&#39;currency&#39;</span><span class="p">,</span> <span class="s">&#39;notes&#39;</span><span class="p">]),</span>
         <span class="s">&#39;list-txn&#39;</span><span class="p">:</span> <span class="n">Task</span><span class="p">(</span><span class="s">&#39;List transactions&#39;</span><span class="p">,</span>
                          <span class="n">callback</span><span class="o">=</span><span class="n">_run_list_transactions</span><span class="p">,</span>
                          <span class="n">required</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;ticker&#39;</span><span class="p">]),</span>
         <span class="s">&#39;delete-txn&#39;</span><span class="p">:</span> <span class="n">Task</span><span class="p">(</span><span class="s">&#39;Delete transactions&#39;</span><span class="p">,</span>
                            <span class="n">callback</span><span class="o">=</span><span class="n">_run_delete_transactions</span><span class="p">,</span>
                            <span class="n">required</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;ticker&#39;</span><span class="p">],</span>
                            <span class="n">optional</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;txnid&#39;</span><span class="p">]),</span>
<span class="p">}</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
