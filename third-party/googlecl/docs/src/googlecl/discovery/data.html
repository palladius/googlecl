<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>data.py</title>
  <link rel="stylesheet" href="../../../pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>data.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Copyright (C) 2011 Google Inc.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<pre><code> http://www.apache.org/licenses/LICENSE-2.0
</code></pre>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
Subclass which manages data for Discovery</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>anages defaults, config values, parsing the arguments,
nd prompting for missing parameters
efaults may be viewed/edited by calling 'edit defaults'
ODO: Integrate ConfigParser</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">simplejson</span> <span class="kn">as</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">googlecl</span>
<span class="kn">import</span> <span class="nn">googlecl.config</span>
<span class="kn">import</span> <span class="nn">optparse</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">googlecl</span><span class="o">.</span><span class="n">LOGGER_NAME</span><span class="p">)</span>
<span class="n">DEFAULT_FILENAME_FORMAT</span> <span class="o">=</span> <span class="s">&#39;dcd_</span><span class="si">%s</span><span class="s">&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Args governing prompting</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">META_ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;prompt&#39;</span><span class="p">,</span> <span class="s">&#39;editor&#39;</span><span class="p">,</span> <span class="s">&#39;editmode&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Args that aren't in method parameters</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">EXTRA_ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">DefaultManager</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Loads config options</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">config</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">load_configuration</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;client_id&#39;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="s">&#39;20958643459.apps.googleusercontent.com&#39;</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;client_secret&#39;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="s">&#39;3D1TrF0sgq52J7zH80jdfbit&#39;</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">devkey2</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;devkey2&#39;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="s">&#39;AIzaSyAmK-fJLcJ0jS2mMIX5EXgU6M6UPT39e50&#39;</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Should make ^ required</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;prompt&#39;</span><span class="p">,</span> 
         <span class="n">default</span><span class="o">=</span><span class="s">&#39;required&#39;</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">editmode</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;editmode&#39;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="s">&#39;cl&#39;</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">formatting</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;formatting&#39;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="s">&#39;pprint&#39;</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">local_apis</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;local_apis&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;[&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_apis</span> <span class="ow">or</span> <span class="s">&#39;(&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_apis</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">local_apis</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_apis</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">lazy_get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;base_url&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;https://www.googleapis.com&#39;</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">safe_get</span><span class="p">(</span><span class="s">&#39;DOCS&#39;</span><span class="p">,</span> <span class="s">&#39;document_editor&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">editor</span><span class="p">:</span>
      <span class="n">editor</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">safe_get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;editor&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">editor</span><span class="p">:</span>
      <span class="kn">import</span> <span class="nn">os</span>
      <span class="n">editor</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;EDITOR&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">editor</span><span class="p">:</span>
      <span class="n">editor</span> <span class="o">=</span> <span class="s">&#39;vim&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">editor</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Turns a list of arguments into a map of keys/values</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">fill_out_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metinfo</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>tarts by doing basic parse, then loads defaults, 
nd finally prompts for missing values</p>
<p>rgs:
 metinfo: The meta-info for the method, 
   such as the required/optional parameters
 args: The arguments which are passed in</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Set up options</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">META_ARGS</span><span class="p">:</span>
      <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="o">+</span><span class="n">arg</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">EXTRA_ARGS</span><span class="p">:</span>
      <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="o">+</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;parameters&#39;</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">]:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;--&quot;</span><span class="o">+</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;request&#39;</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">:</span>
      <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;--body&quot;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s">&#39;schemas&#39;</span><span class="p">][</span><span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;request&#39;</span><span class="p">][</span><span class="s">&#39;$ref&#39;</span><span class="p">]][</span><span class="s">&#39;properties&#39;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="o">+</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionConflictError</span><span class="p">:</span>
          <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Parse args</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Loads defaults</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">config</span> <span class="o">=</span> <span class="n">googlecl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">load_configuration</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]):</span>
      <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
          <span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">arg</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Attaches unmatched values to appropriate keys</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;parameterOrder&#39;</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">:</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Received unexpected parameter.&#39;</span><span class="p">)</span>
        <span class="k">return</span>
      <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;parameterOrder&#39;</span><span class="p">]</span>
               <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">],</span><span class="n">args</span><span class="p">))</span>
      <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Prompts for missing values</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;prompt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span> <span class="ow">and</span> <span class="s">&#39;parameterOrder&#39;</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;parameterOrder&#39;</span><span class="p">]:</span> <span class="c"># Required parameters</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Please specify &#39;</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span><span class="p">)</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span>
          <span class="n">kwargs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;prompt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span> <span class="ow">and</span> <span class="s">&#39;parameters&#39;</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">]:</span> <span class="c"># Optional parameters</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Please specify &#39;</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s">&#39;{&#39;</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;[&#39;</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;(&#39;</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
          <span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>

    <span class="k">if</span> <span class="s">&#39;parameters&#39;</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">:</span>
      <span class="n">pars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">pars</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Assumes that unknown keys are part of body</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="s">&#39;body&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s">&#39;request&#39;</span> <span class="ow">in</span> <span class="n">metinfo</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">META_ARGS</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">EXTRA_ARGS</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pars</span><span class="p">):</span>
      <span class="n">body</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">META_ARGS</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">EXTRA_ARGS</span><span class="p">):</span>
        <span class="n">body</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
      <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Prompts for missing body</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;prompt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span> <span class="ow">and</span> <span class="s">&#39;body&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s">&#39;request&#39;</span> <span class="ow">in</span> <span class="n">metinfo</span><span class="p">:</span>
      <span class="n">schemaname</span> <span class="o">=</span> <span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;request&#39;</span><span class="p">][</span><span class="s">&#39;$ref&#39;</span><span class="p">]</span>
      <span class="n">schema</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">&#39;schemas&#39;</span><span class="p">][</span><span class="n">schemaname</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;editmode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;editor&#39;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">subprocess</span>
        <span class="kn">import</span> <span class="nn">tempfile</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="n">fd</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Assembles the outline of the body
Will modify to use required/mutable args if/when it is available</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">[</span><span class="s">&#39;properties&#39;</span><span class="p">]:</span>
          <span class="k">if</span> <span class="s">&#39;default&#39;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">[</span><span class="s">&#39;properties&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
            <span class="n">body</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="s">&#39;properties&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">][</span><span class="s">&#39;default&#39;</span><span class="p">]</span>
          <span class="k">elif</span> <span class="s">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">[</span><span class="s">&#39;properties&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
            <span class="n">body</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;&lt;&quot;</span><span class="o">+</span><span class="n">schema</span><span class="p">[</span><span class="s">&#39;properties&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;&gt;&quot;</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;editor&#39;</span><span class="p">],</span> <span class="n">filename</span><span class="p">)</span>
        <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Missing body...&#39;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Missing body - Schema: &#39;</span> <span class="o">+</span> <span class="n">schemaname</span>
        <span class="n">sargs</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">schema</span><span class="p">[</span><span class="s">&#39;properties&#39;</span><span class="p">])</span>
        <span class="k">print</span> <span class="s">&#39;  Args: &#39;</span> <span class="o">+</span> <span class="n">sargs</span>
        <span class="n">bodyparser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">()</span> 
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s">&#39;schemas&#39;</span><span class="p">][</span><span class="n">metinfo</span><span class="p">[</span><span class="s">&#39;request&#39;</span><span class="p">][</span><span class="s">&#39;$ref&#39;</span><span class="p">]][</span><span class="s">&#39;properties&#39;</span><span class="p">]:</span>
          <span class="n">bodyparser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="o">+</span><span class="n">arg</span><span class="p">)</span>
        <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">bodyparser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Please specify body: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
          <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">value</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
          <span class="k">return</span>
      <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>Get rid of meta-args</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">META_ARGS</span><span class="p">:</span>
      <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Can't have '-'s in keys</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="s">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">kwargs</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
